﻿<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title> Client</title>
    <!--<link rel="stylesheet" type="text/css" href="mystyle.css">-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="js/globalVar.js"></script> <!-- ESEGUITI => se lavorano su elementi del DOM vanno caricati dopo -->
    <script src="js/loadGap.js"></script>
    <script src="js/costruttiva.js"></script>
    <script src="js/localSearch.js"></script>
    <script src="js/costruttiva.js"></script>
    <script src="js/ILS.js"></script>
    <script src="js/GRASP.js"></script>
</head>
<body onload="init()">
    <div>
        ID: <input type="number" value="0" id="txtId" style="width:5em">
        <input type="button" value="Read" onclick="findById();" />
        <input type="button" value="Delete" onclick="deleteId();" />
        <input type="button" value="Get GAP Instance" onclick="getInstance();" /><br />
        ID: <input type="number" value="0" id="txtIdIns" style="width:5em">
        Quantità: <input type="number" value="0" id="txtNewQuant" style="width:10em">
        <input type="button" value="Insert" onclick="insertId();" />
        <input type="button" value="Update" onclick="updateId();" /><br />
        <input type="button" value="Read all" onclick="findAll();" /><br />
        <br />
        <input type="text" id="inputRemote" value="homemade/toy.json" style="width:10em" />
        <input type="button" value="Get remote instance" onclick="readWithCORS();" /><br />
        <input type="button" value="Costruttiva" onclick="solveConstruct();" /><br />
        <input type="button" value="Local search" onclick="run_opt10(c);" /><br />
        Tempo massimo (in millis): <input type="number" id="time" value="2000" style="width:10em" /><br />
        <input type="button" value="Integrated Local Search" onclick="ILS(c);" /><br />
        <input type="button" value="GRASP" onclick="grasp();" /><br />
    </div>
    <script>
        function init() { }
        function findById() {
            var id = $('#txtId').val();
            $.ajax({
                url: "api/Clienti/GetCustClient/" + id,
                type: "GET",
                contentType: "application/json",
                data: "",
                success: function (result) {
                    alert(result);
                },
                error: function (xhr, status, p3, p4) {
                    var err = "Error " + " " + status + " " + p3;
                    if (xhr.responseText && xhr.responseText[0] == "{")
                        err = JSON.parse(xhr.responseText).message;
                    alert(err);
                }
            });
        }
        function findAll() {
            $.ajax(
            {
                url: "api/Clienti/GetAllClients",
                type: "GET",
                contentType: "application/json",
                data: "",
                success: function (result) {
                    //readResult(result);
                    alert(result);
                },
                error: function (xhr, status, p3, p4) {
                    var err = "Error " + " " + status + " " + p3;
                    if (xhr.responseText && xhr.responseText[0] == "{")
                        err = JSON.parse(xhr.responseText).message;
                    alert(err);
                }
            });
        }
        function insertId() {
            var id = $('#txtIdIns').val();
            var quant = $('#txtNewQuant').val();
            var options = {};
            options.url = "/api/Clienti/insertCustomer";
            options.type = "POST";
            options.data = JSON.stringify({
                "id": id,
                "req": quant,
                "mag": -1
            });
            options.dataType = "json";
            options.contentType = "application/json";
            options.success = function (msg) {
                alert(msg);
            };
            options.error = function (err) { alert(err.statusText); };
            $.ajax(options);
        }

        function updateId() {
            var options = {};
            options.url = "/api/Clienti/updateCustomer";
            options.type = "PUT";
            options.data = JSON.stringify({
                "id": $("#txtIdIns").val(),
                "req": $('#txtNewQuant').val()
            });
            options.dataType = "json";
            options.contentType = "application/json";
            options.success = function (msg) { alert(msg); };
            options.error = function (err) { alert(err.statusText); };
            $.ajax(options);
        };

        function deleteId() {
            var options = {};
            options.url = "/api/Clienti/deleteCustomer/" + $("#txtId").val();
            options.type = "DELETE";
            options.contentType = "application/json";
            options.success = function (msg) {
                alert(msg);
            };
            options.error = function (err) { alert(err.statusText); };
            $.ajax(options);
        }

        function AjaxHelper(baseUrl) {
            this._baseUrl = baseUrl;
            var callWebAPI = function (url, verb, data, callback) {
                var xhr = new XMLHttpRequest();
                xhr.onload = function (evt) {
                    var data = JSON.parse(evt.target.responseText);
                    callback(data);
                }
                xhr.onerror = function () {
                    alert("Error while calling Web API");
                }
                xhr.open(verb, url);
                xhr.setRequestHeader("Content-Type", "application/json");
                if (data == null) xhr.send();
                else xhr.send(JSON.stringify(data));
            }
            this.getGAPInstance = function (id, callback) {
                callWebAPI(this._baseUrl + "/" + id, "GET", null, callback);
            }
        }

        //chiamata xmlhttprequest
        function getInstance() {
            var ajaxHelper = new AjaxHelper("/api/Clienti");

            var getGAPCallback = function (res) {
                alert(res);
                console.log(res);
                alert("Got instance " + jInstance.name + " n=" + n);
            }

            var actionCallback = function (msg) {
                alert(msg);
            }

            //GET
            let id = $("#txtId").val();
            console.log(id);
            ajaxHelper.getGAPInstance("getGAPInstance?id=" + id, getGAPCallback);
        }
    </script>
</body>
</html>